# ============================================
# DDCPTS Environment Configuration Template
# ============================================
# Copy this file to .env and fill in actual values
# NEVER commit .env with real credentials to git

# ============================================
# APPLICATION
# ============================================
ENVIRONMENT=development  # development | staging | production
DEBUG=true  # Set to false in production
LOG_LEVEL=INFO  # DEBUG | INFO | WARNING | ERROR | CRITICAL
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4  # Uvicorn workers (typically 2-4x CPU cores)

# CORS (comma-separated origins for production)
CORS_ORIGINS=http://localhost:3000,http://localhost:5173

# ============================================
# DATABASE
# ============================================
# PostgreSQL connection string
DATABASE_URL=postgresql://ddcpts:ddcpts_dev_password@db:5432/ddcpts_dev

# Connection pool settings
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# ============================================
# SECURITY & AUTHENTICATION
# ============================================
# Generate with: openssl rand -hex 32
SECRET_KEY=your-secret-key-here-use-openssl-rand-hex-32

# JWT settings
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# Password policy
MIN_PASSWORD_LENGTH=8
REQUIRE_PASSWORD_UPPERCASE=true
REQUIRE_PASSWORD_LOWERCASE=true
REQUIRE_PASSWORD_DIGIT=true
REQUIRE_PASSWORD_SPECIAL_CHAR=true

# Rate limiting (requests per minute)
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_AUTH_PER_MINUTE=10

# ============================================
# SMS PROVIDER
# ============================================
SMS_PROVIDER=africastalking  # africastalking | twilio | mock

# Africa's Talking
# Get sandbox key from: https://account.africastalking.com/apps/sandbox
AFRICASTALKING_USERNAME=sandbox
AFRICASTALKING_API_KEY=your-africastalking-api-key
AFRICASTALKING_SENDER_ID=DDCPTS
AFRICASTALKING_ENVIRONMENT=sandbox  # sandbox | production

# Twilio (alternative provider)
TWILIO_ACCOUNT_SID=your-twilio-account-sid
TWILIO_AUTH_TOKEN=your-twilio-auth-token
TWILIO_PHONE_NUMBER=+1234567890

# SMS Configuration
SMS_RETRY_ATTEMPTS=3
SMS_RETRY_DELAY_SECONDS=60
SMS_MAX_LENGTH=160  # GSM 7-bit characters

# ============================================
# PAYMENT PROVIDER (M-Pesa Daraja)
# ============================================
# Get sandbox credentials from: https://developer.safaricom.co.ke/
MPESA_ENVIRONMENT=sandbox  # sandbox | production
MPESA_CONSUMER_KEY=your-mpesa-consumer-key
MPESA_CONSUMER_SECRET=your-mpesa-consumer-secret
MPESA_SHORTCODE=174379  # Your business shortcode (sandbox default)
MPESA_PASSKEY=your-mpesa-passkey
MPESA_INITIATOR_NAME=testapi
MPESA_INITIATOR_PASSWORD=your-initiator-password

# B2C Configuration
MPESA_B2C_QUEUE_TIMEOUT_URL=https://yourdomain.com/api/v1/mpesa/b2c/timeout
MPESA_B2C_RESULT_URL=https://yourdomain.com/api/v1/mpesa/b2c/result
MPESA_COMMAND_ID=BusinessPayment  # BusinessPayment | SalaryPayment | PromotionPayment

# Safety settings
ENABLE_REAL_PAYMENTS=false  # MUST be false until production ready
PAYMENT_DRY_RUN_DEFAULT=true
PAYMENT_MAX_AMOUNT_DAILY=1000000  # KES
PAYMENT_MIN_AMOUNT=100  # KES
REQUIRE_PAYMENT_APPROVAL=false  # Set true for dual approval

# ============================================
# BUSINESS LOGIC
# ============================================
# Pricing (KES per liter)
PRICE_PER_LITER=45.00
QUALITY_GRADE_A_MULTIPLIER=1.10  # 10% premium
QUALITY_GRADE_B_MULTIPLIER=1.00  # Base price
QUALITY_GRADE_C_MULTIPLIER=0.85  # 15% penalty
MINIMUM_PAYMENT_THRESHOLD=100.00  # KES

# Delivery validation
MIN_DELIVERY_LITERS=0.1
MAX_DELIVERY_LITERS=200.0

# Quality grading
GRADE_A_MIN_FAT_CONTENT=3.5
GRADE_B_MIN_FAT_CONTENT=3.0
GRADE_C_MIN_FAT_CONTENT=2.5

# ============================================
# MONITORING & OBSERVABILITY
# ============================================
# Sentry (error tracking)
# Get DSN from: https://sentry.io/
SENTRY_DSN=your-sentry-dsn
SENTRY_ENVIRONMENT=development
SENTRY_TRACES_SAMPLE_RATE=0.1  # 10% of transactions

# Metrics
ENABLE_METRICS=true
METRICS_PORT=9090

# Logging
LOG_JSON_FORMAT=false  # Set true for production (structured logging)
LOG_PII_MASKING=true  # Mask sensitive data in logs

# ============================================
# STORAGE & BACKUP
# ============================================
# AWS S3 (for backups and archived data)
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key
S3_BUCKET_BACKUPS=ddcpts-backups
S3_BUCKET_ARCHIVES=ddcpts-archives

# Backup configuration
BACKUP_RETENTION_DAYS=30
ARCHIVE_AFTER_MONTHS=12

# ============================================
# REDIS (for background tasks and caching)
# ============================================
REDIS_URL=redis://redis:6379/0
REDIS_MAX_CONNECTIONS=50

# ============================================
# LOCALIZATION
# ============================================
DEFAULT_LANGUAGE=en  # en | sw (Swahili)
SUPPORTED_LANGUAGES=en,sw
DEFAULT_TIMEZONE=Africa/Nairobi
DEFAULT_CURRENCY=KES

# ============================================
# FEATURE FLAGS
# ============================================
ENABLE_2FA=false  # Two-factor authentication
ENABLE_FARMER_FEEDBACK=true
ENABLE_BULK_IMPORT=true
ENABLE_ANALYTICS_DASHBOARD=true
ENABLE_OFFLINE_SYNC=true

# ============================================
# DEVELOPMENT & TESTING
# ============================================
# Test database (separate from dev DB)
TEST_DATABASE_URL=postgresql://ddcpts:ddcpts_test_password@db:5432/ddcpts_test

# Mock services in development
USE_MOCK_SMS=false  # Set true to skip actual SMS sending
USE_MOCK_PAYMENTS=false  # Set true to skip actual M-Pesa calls

# Seed data
CREATE_SEED_DATA=true  # Auto-create test farmers/stations on startup
SEED_ADMIN_EMAIL=admin@ddcpts.test
SEED_ADMIN_PASSWORD=Admin@123  # CHANGE IMMEDIATELY

# ============================================
# PRODUCTION ONLY
# ============================================
# Uncomment and configure for production deployment

# TLS/HTTPS
# FORCE_HTTPS=true
# HSTS_MAX_AGE=31536000

# Database (use managed service URL)
# DATABASE_URL=postgresql://user:pass@prod-rds.amazonaws.com:5432/ddcpts_prod

# Secrets Manager (override individual secrets)
# USE_AWS_SECRETS_MANAGER=true
# AWS_SECRETS_MANAGER_SECRET_NAME=ddcpts/prod/secrets

# Auto-scaling
# AUTO_SCALE_MIN_INSTANCES=2
# AUTO_SCALE_MAX_INSTANCES=10
# AUTO_SCALE_TARGET_CPU_PERCENT=70

# ============================================
# MOBILE APP CONFIGURATION
# ============================================
# API endpoint for mobile app
MOBILE_API_BASE_URL=http://localhost:8000/api/v1

# Sync configuration
SYNC_INTERVAL_MINUTES=30
SYNC_BATCH_SIZE=100
SYNC_RETRY_ATTEMPTS=5

# Offline storage
OFFLINE_MAX_DELIVERIES=1000  # Local storage limit
OFFLINE_DATA_RETENTION_DAYS=90
